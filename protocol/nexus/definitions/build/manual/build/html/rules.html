


<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.2.3.1. Rules for Structuring Information in NeXus Files &#8212; nexus v2024.02 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css?v=87629129" />
    <link rel="stylesheet" type="text/css" href="_static/details_summary_hide.css?v=30df4bca" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" href="_static/blockquote.css" type="text/css" />
    <link rel="stylesheet" href="_static/rubric.css" type="text/css" />
    <script src="_static/documentation_options.js?v=04096e4a"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="1.2.3.2. Rules for Storing Data Items in NeXus Files" href="datarules.html" />
    <link rel="prev" title="1.2. NeXus Design" href="design.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="datarules.html" title="1.2.3.2. Rules for Storing Data Items in NeXus Files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="design.html" title="1.2. NeXus Design"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">nexus v2024.02 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="user_manual.html" ><span class="section-number">1. </span>NeXus: User Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="design.html" accesskey="U"><span class="section-number">1.2. </span>NeXus Design</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">1.2.3.1. </span>Rules for Structuring Information in NeXus Files</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="rules-for-structuring-information-in-nexus-files">
<span id="rules"></span><span id="index-0"></span><h1><span class="section-number">1.2.3.1. </span>Rules for Structuring Information in NeXus Files<a class="headerlink" href="#rules-for-structuring-information-in-nexus-files" title="Link to this heading">¶</a></h1>
<p>All NeXus files contain one or many groups of type <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> at root level.
Many files contain only one
<code class="docutils literal notranslate"><span class="pre">NXentry</span></code>
group, then the name is <code class="docutils literal notranslate"><span class="pre">entry</span></code>.
The NXentry level of hierarchy is there to support the storage of multiple related experiments in one file.
Or to allow the NeXus file to serve as a container for storing a whole scientific workflow from data acquisition to
publication ready data.
Also, <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> class
groups can contain raw data or processed data.
For files with more than one <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group, since HDF requires
that no two items at the same level in an HDF file may have the same name,
the NeXus fashion is to
assign <span class="target" id="index-1"></span>names with an incrementing index appended, such as
<code class="docutils literal notranslate"><span class="pre">entry1</span></code>, <code class="docutils literal notranslate"><span class="pre">entry2</span></code>, <code class="docutils literal notranslate"><span class="pre">entry3</span></code>, etc.</p>
<p>In order to illustrate what is written in the text, example hierarchies like the one in
figure <a class="reference internal" href="#table-rawdata"><span class="std std-ref">Raw Data</span></a> are provided.</p>
<section id="content-of-a-raw-data-nxentry-group">
<span id="rules-nxentry-raw-data"></span><h2>Content of a Raw Data <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> Group<a class="headerlink" href="#content-of-a-raw-data-nxentry-group" title="Link to this heading">¶</a></h2>
<p>An example raw data hierarchy is
shown in figure <a class="reference internal" href="#table-rawdata"><span class="std std-ref">Raw Data</span></a>
(only showing the relevant parts of the data hierarchy).
In the example shown, the <code class="docutils literal notranslate"><span class="pre">data</span></code> field in the <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group
is linked to the 2-D detector data (a 512x512 array of 32-bit integers).
The attribute <code class="docutils literal notranslate"><span class="pre">signal</span> <span class="pre">=</span> <span class="pre">data</span></code> on the <a class="reference internal" href="classes/base_classes/NXdata.html#nxdata"><span class="std std-ref">NXdata</span></a> group marks this
field as the default plottable data of the <code class="docutils literal notranslate"><span class="pre">data:NXdata</span></code> group.
The NXdata group attribute <code class="docutils literal notranslate"><span class="pre">axes</span> <span class="pre">=</span> <span class="pre">.</span> <span class="pre">.</span></code> declares that both dimensions of
the <code class="docutils literal notranslate"><span class="pre">data</span></code> field do not have associated dimension scales (plotting
routines should use integer scaling for each axis).
Note that <code class="docutils literal notranslate"><span class="pre">[,]</span></code> represents a 2D array.</p>
<blockquote>
<div><div class="compound">
<p class="rubric">NeXus Raw Data Hierarchy</p>
<div class="highlight-text notranslate" id="table-rawdata"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    entry:NXentry
<span class="linenos"> 2</span>        @default = data
<span class="linenos"> 3</span>        instrument:NXinstrument
<span class="linenos"> 4</span>            source:NXsource
<span class="linenos"> 5</span>            ....
<span class="linenos"> 6</span>            detector:NXdetector
<span class="linenos"> 7</span>                data:NX_INT32[512,512]
<span class="linenos"> 8</span>        sample:NXsample
<span class="linenos"> 9</span>        control:NXmonitor
<span class="linenos">10</span>        data:NXdata
<span class="linenos">11</span>            @signal = data
<span class="linenos">12</span>            @axes = [&quot;.&quot;, &quot;.&quot;]
<span class="linenos">13</span>            data --&gt; /entry/instrument/detector/data
</pre></div>
</div>
</div>
</div></blockquote>
<p>An <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> describing raw data contains at least a <code class="docutils literal notranslate"><span class="pre">NXsample</span></code>,
one <code class="docutils literal notranslate"><span class="pre">NXmonitor</span></code>,
one <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> and a <code class="docutils literal notranslate"><span class="pre">NXinstrument</span></code> group.
It is good practice to use the names
<code class="docutils literal notranslate"><span class="pre">sample</span></code> for the <code class="docutils literal notranslate"><span class="pre">NXsample</span></code> group,
<code class="docutils literal notranslate"><span class="pre">control</span></code> for the <code class="docutils literal notranslate"><span class="pre">NXmonitor</span></code> group holding the
experiment controlling monitor and
<code class="docutils literal notranslate"><span class="pre">instrument</span></code> for the <code class="docutils literal notranslate"><span class="pre">NXinstrument</span></code> group.
The <code class="docutils literal notranslate"><span class="pre">NXinstrument</span></code> group contains further groups describing the individual
components of the instrument as appropriate.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group contains links to all those data items in the <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> <span class="target" id="index-2"></span>hierarchy
which are required to put up a default plot of the data.
As an example consider a SAXS instrument with a 2D detector.
The <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> will then hold a link to the detector image.
If there is only one <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group,
it is good practice to name it <code class="docutils literal notranslate"><span class="pre">data</span></code>.
Otherwise, the name of the detector bank represented is a good selection.</p>
</section>
<section id="content-of-a-processed-data-nxentry-group">
<span id="rules-nxentry-processed-data"></span><h2>Content of a processed data <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group<a class="headerlink" href="#content-of-a-processed-data-nxentry-group" title="Link to this heading">¶</a></h2>
<p>Processed data, see figure  <a class="reference internal" href="#table-processeddata"><span class="std std-ref">Processed Data</span></a>,
in this context means the results of a data reduction or
data analysis program. Note that <code class="docutils literal notranslate"><span class="pre">[]</span></code> represents a 1D array.</p>
<blockquote>
<div><div class="compound">
<p class="rubric">NeXus Processed Data Hierarchy</p>
<div class="highlight-text notranslate" id="table-processeddata"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    entry:NXentry
<span class="linenos"> 2</span>        @default = data
<span class="linenos"> 3</span>        reduction:NXprocess
<span class="linenos"> 4</span>            program_name = &quot;pyDataProc2010&quot;
<span class="linenos"> 5</span>            version = &quot;1.0a&quot;
<span class="linenos"> 6</span>            input:NXparameters
<span class="linenos"> 7</span>                filename = &quot;sn2013287.nxs&quot;
<span class="linenos"> 8</span>        sample:NXsample
<span class="linenos"> 9</span>        data:NXdata
<span class="linenos">10</span>            @signal = data
<span class="linenos">11</span>            @axes = &quot;.&quot;
<span class="linenos">12</span>            data
</pre></div>
</div>
</div>
</div></blockquote>
<p>NeXus stores such data in a simplified
<code class="docutils literal notranslate"><span class="pre">NXentry</span></code> structure. A processed data <code class="docutils literal notranslate"><span class="pre">NXentry</span></code>
has at minimum a <code class="docutils literal notranslate"><span class="pre">NXsample</span></code>,
a <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> and a <code class="docutils literal notranslate"><span class="pre">NXprocess</span></code> group.
Again the preferred name for the <code class="docutils literal notranslate"><span class="pre">NXsample</span></code>
group is <code class="docutils literal notranslate"><span class="pre">sample</span></code>.
In the case of processed data, the <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group holds the
result of the processing together with the associated axis data.
The <code class="docutils literal notranslate"><span class="pre">NXprocess</span></code>
group holds the name and version of the program used for this processing
step and further <code class="docutils literal notranslate"><span class="pre">NXparameters</span></code> groups. These groups ought to contain the
parameters used for this data processing step in suitable detail so that
the processing step can be reproduced.</p>
<p>Optionally a processed data <code class="docutils literal notranslate"><span class="pre">NXentry</span></code>
can hold a <code class="docutils literal notranslate"><span class="pre">NXinstrument</span></code> group with
further groups holding relevant information about the instrument. The
preferred name is again <code class="docutils literal notranslate"><span class="pre">instrument</span></code>. Whereas for a raw data file, NeXus
strives to capture as much data as possible, a <code class="docutils literal notranslate"><span class="pre">NXinstrument</span></code> group for
processed data may contain a much-reduced subset.</p>
</section>
<section id="nxsubentry-or-multi-method-data">
<span id="rules-subentry"></span><h2><code class="docutils literal notranslate"><span class="pre">NXsubentry</span></code> or Multi-Method Data<a class="headerlink" href="#nxsubentry-or-multi-method-data" title="Link to this heading">¶</a></h2>
<p>Especially at synchrotron facilities, there are experiments which perform several different methods
on the sample at the same time. For example, combine a powder diffraction experiment with XAS.
This may happen in the same scan, so the data needs to be grouped together. A suitable <code class="docutils literal notranslate"><span class="pre">NXentry</span></code>
would need to adhere to two different application definitions. This leads to name clashes which cannot be
resolved easily. In order to solve this issue, the following scheme was implemented in NeXus:</p>
<ul class="simple">
<li><p>The complete beamline (all data) is stored in an
appropriate hierarchy in an <code class="docutils literal notranslate"><span class="pre">NXentry</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group contains further <code class="docutils literal notranslate"><span class="pre">NXsubentry</span></code> groups,
one for each method.</p></li>
<li><p>Each <a class="reference internal" href="classes/base_classes/NXsubentry.html#nxsubentry"><span class="std std-ref">NXsubentry</span></a> group is constructed
like a <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group.
It contains links to all those data items required to fulfill
the application definition for the particular. method it represents.</p></li>
<li><p>The name of the application definition is stored in the <code class="docutils literal notranslate"><span class="pre">definition</span></code>
field of the <a class="reference internal" href="classes/base_classes/NXsubentry.html#nxsubentry"><span class="std std-ref">NXsubentry</span></a> group</p></li>
<li><p>Each <code class="docutils literal notranslate"><span class="pre">NXsubentry</span></code> group contains a <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group describing
the default plottable data for that experimental method.
To satisfy the NeXus requirement of finding the default
plottable data from a <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group, the <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group
from one of these <code class="docutils literal notranslate"><span class="pre">NXsubentry</span></code> groups (the fluoresence data)
was linked.</p></li>
</ul>
<p>See figure <a class="reference internal" href="#table-nxsubentry"><span class="std std-ref">NeXus Multi Method Hierarchy</span></a> for an example hierarchy.
Note that <code class="docutils literal notranslate"><span class="pre">[,]</span></code> represents a 2D array.</p>
<blockquote>
<div><div class="compound">
<p class="rubric">NeXus Multi Method Hierarchy</p>
<div class="highlight-text notranslate" id="table-nxsubentry"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    entry:NXentry
<span class="linenos"> 2</span>        @default = data
<span class="linenos"> 3</span>        user:NXuser
<span class="linenos"> 4</span>        sample:NXsample
<span class="linenos"> 5</span>        instrument:NXinstument
<span class="linenos"> 6</span>            SASdet:NXdetector
<span class="linenos"> 7</span>                data:[,]
<span class="linenos"> 8</span>            fluordet:NXdetector
<span class="linenos"> 9</span>                data:[,]
<span class="linenos">10</span>            large_area:NXdetector
<span class="linenos">11</span>                data:[,]
<span class="linenos">12</span>        SAS:NXsubentry
<span class="linenos">13</span>            definition = &quot;NXsas&quot;
<span class="linenos">14</span>            instrument:NXinstrument
<span class="linenos">15</span>                detector:NXdetector
<span class="linenos">16</span>                    data --&gt; /entry/instrument/SASdet/data
<span class="linenos">17</span>            data:NXdata
<span class="linenos">18</span>                data --&gt; /entry/instrument/SASdet/data
<span class="linenos">19</span>        Fluo:NXsubentry
<span class="linenos">20</span>            definition = &quot;NXfluo&quot;
<span class="linenos">21</span>            instrument:NXinstrument
<span class="linenos">22</span>                detector --&gt; /entry/instrument/fluordet/data
<span class="linenos">23</span>                detector2 --&gt; /entry/instrument/large_area/data
<span class="linenos">24</span>            data:NXdata
<span class="linenos">25</span>                @signal = detector
<span class="linenos">26</span>                @axes = [&quot;.&quot;, &quot;.&quot;]
<span class="linenos">27</span>                detector --&gt; /entry/instrument/fluordet/data
<span class="linenos">28</span>        data:NXdata --&gt; /entry/Fluo/data
</pre></div>
</div>
</div>
</div></blockquote>
</section>
<section id="rules-for-special-cases">
<span id="rules-specialcases"></span><h2>Rules for Special Cases<a class="headerlink" href="#rules-for-special-cases" title="Link to this heading">¶</a></h2>
<section id="scans">
<span id="rules-specialcases-scans"></span><h3>Scans<a class="headerlink" href="#scans" title="Link to this heading">¶</a></h3>
<p>Scans are difficult to capture because they have great variety. Basically,
any variable can be scanned. Such behaviour cannot be captured in application definitions.
Therefore NeXus solves this difficulty with a set of
rules. In this section, <code class="docutils literal notranslate"><span class="pre">NP</span></code> is used as a symbol for the number of scan
points.</p>
<ul class="simple">
<li><p>The scan dimension <code class="docutils literal notranslate"><span class="pre">NP</span></code> is always the first dimension of any
multi-dimensional dataset. The reason for this is that HDF allows the first
dimension of a dataset to be unlimited.
Which means, that data can be
appended to the dataset during the scan.</p></li>
<li><p>All data is stored as arrays of dimensions <code class="docutils literal notranslate"><span class="pre">NP</span></code>, original dimensions
of the data at the appropriate position in the <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> <span class="target" id="index-3"></span>hierarchy.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group has to contain links to all variables varied during
the scan and the detector data. Thus the <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group  mimics the usual
tabular representation of a scan.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group has attributes
to enable the <span class="target" id="index-4"></span>default plotting,
as described in the section titled
<a class="reference internal" href="design.html#nxdata-facilitates-thedefaultplot"><span class="std std-ref">NXdata Facilitates Automatic Plotting</span></a>.</p></li>
</ul>
<section id="simple-scan">
<h4>Simple scan<a class="headerlink" href="#simple-scan" title="Link to this heading">¶</a></h4>
<p>Examples may be in order here. Let us start with a simple case, the sample is
rotated around its rotation axis and data is collected in a single point
detector. See figure <a class="reference internal" href="#table-simplescan"><span class="std std-ref">Simple Scan</span></a> for an overview.
Then we have:</p>
<blockquote>
<div><ul class="simple">
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXinstrument/NXdetector/data</span></code>
of length <code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the count data.</p></li>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/rotation_angle</span></code>
of length <code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the positions of <code class="docutils literal notranslate"><span class="pre">rotation_angle</span></code> at the various steps of the scan.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXdata</span></code> contains links to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXinstrument/NXdetector/data</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/rotation_angle</span></code></p></li>
</ul>
</li>
<li><p>All other fields have their normal dimensions.</p></li>
</ul>
<div class="compound">
<p class="rubric">NeXus Simple Scan Example</p>
<div class="highlight-text notranslate" id="table-simplescan"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    entry:NXentry
<span class="linenos"> 2</span>        @default = data
<span class="linenos"> 3</span>        instrument:NXinstrument
<span class="linenos"> 4</span>            detector:NXdetector
<span class="linenos"> 5</span>                data[NP]
<span class="linenos"> 6</span>        sample:NXsample
<span class="linenos"> 7</span>            rotation_angle[NP]
<span class="linenos"> 8</span>        control:NXmonitor
<span class="linenos"> 9</span>            data[NP]
<span class="linenos">10</span>        data:NXdata
<span class="linenos">11</span>            @signal = &quot;data&quot;
<span class="linenos">12</span>            @axes = &quot;rotation_angle&quot;
<span class="linenos">13</span>            @rotation_angle_indices = 0
<span class="linenos">14</span>            data --&gt; /entry/instrument/detector/data
<span class="linenos">15</span>            rotation_angle --&gt; /entry/sample/rotation_angle
</pre></div>
</div>
</div>
</div></blockquote>
</section>
<section id="simple-scan-with-area-detector">
<h4>Simple scan with area detector<a class="headerlink" href="#simple-scan-with-area-detector" title="Link to this heading">¶</a></h4>
<p>The next example is the same scan but with an area detector with <code class="docutils literal notranslate"><span class="pre">xsize</span></code>
times <code class="docutils literal notranslate"><span class="pre">ysize</span></code> pixels. The only thing which changes is that
<code class="docutils literal notranslate"><span class="pre">/NXentry/NXinstrument/NXdetector/data</span></code> will have the dimensions
<code class="docutils literal notranslate"><span class="pre">NP,</span> <span class="pre">xsize,</span> <span class="pre">ysize</span></code>. See figure <a class="reference internal" href="#fig-simplescanarea"><span class="std std-ref">Simple Scan with Area Detector</span></a> for an overview.</p>
<blockquote>
<div><div class="compound">
<p class="rubric">NeXus Simple Scan Example with Area Detector</p>
<div class="highlight-text notranslate" id="fig-simplescanarea"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    entry:NXentry
<span class="linenos"> 2</span>        instrument:NXinstrument
<span class="linenos"> 3</span>            detector:NXdetector
<span class="linenos"> 4</span>                data:[NP,xsize,ysize]
<span class="linenos"> 5</span>        sample:NXsample
<span class="linenos"> 6</span>            rotation_angle[NP]
<span class="linenos"> 7</span>        control:NXmonitor
<span class="linenos"> 8</span>            data[NP]
<span class="linenos"> 9</span>        data:NXdata
<span class="linenos">10</span>            @signal = &quot;data&quot;
<span class="linenos">11</span>            @axes = [&quot;rotation_angle&quot;, &quot;.&quot;, &quot;.&quot;]
<span class="linenos">12</span>            @rotation_angle_indices = 0
<span class="linenos">13</span>            data --&gt; /entry/instrument/detector/data
<span class="linenos">14</span>            rotation_angle --&gt; /entry/sample/rotation_angle
</pre></div>
</div>
</div>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> group attribute <code class="docutils literal notranslate"><span class="pre">axes</span> <span class="pre">=</span> <span class="pre">rotation_angle</span> <span class="pre">.</span> <span class="pre">.</span></code> declares that only the first
dimension of the plottable <code class="docutils literal notranslate"><span class="pre">data</span></code> has a dimension scale (by name, <code class="docutils literal notranslate"><span class="pre">rotation_angle</span></code>).
The other two dimensions have no associated dimension scales and should be plotted against
integer bin numbers.</p>
</section>
<section id="complex-hkl-scan">
<h4>Complex <em>hkl</em> scan<a class="headerlink" href="#complex-hkl-scan" title="Link to this heading">¶</a></h4>
<p>The next example involves a complex movement along the <span class="math notranslate nohighlight">\(h\)</span> axis in reciprocal
space which requires mutiple motors of a <span class="target" id="index-5"></span>four-circle diffractometer to be
varied during the scan. We then have:</p>
<ul>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXinstrument/NXdetector/data</span></code> of length
<code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the count data.</p></li>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXinstrument/NXdetector/polar_angle</span></code> of length
<code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the positions of the detector’s polar_angle at the various steps
of the scan.</p></li>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/rotation_angle</span></code> of length
<code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the positions of <code class="docutils literal notranslate"><span class="pre">rotation_angle</span></code> at the various steps of the scan.</p></li>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/chi</span></code> of length <code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the positions of chi at the various steps of the scan.</p></li>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/phi</span></code> of length <code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the positions of phi at the various steps of the scan.</p></li>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/h</span></code> of length <code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the positions of the reciprocal coordinate <span class="math notranslate nohighlight">\(h\)</span> at the
various steps of the scan.</p></li>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/k</span></code> of length <code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the positions of the reciprocal coordinate <span class="math notranslate nohighlight">\(k\)</span> at the
various steps of the scan.</p></li>
<li><p>A dataset at <code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/l</span></code> of length <code class="docutils literal notranslate"><span class="pre">NP</span></code> containing
the positions of the reciprocal coordinate <span class="math notranslate nohighlight">\(l\)</span> at the
various steps of the scan.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXdata</span></code> contains links to:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXinstrument/NXdetector/data</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXinstrument/NXdetector/polar_angle</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/rotation_angle</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/chi</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/phi</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/k</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NXentry/NXsample/l</span></code></p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> also contains appropriate attributes
as described in <a class="reference internal" href="datarules.html#design-findplottable-niac2014"><span class="std std-ref">Associating plottable data using attributes applied to the NXdata group</span></a>.</p>
</li>
<li><p>All other fields have their normal dimensions.</p></li>
</ul>
<div class="compound">
<p class="rubric">NeXus Complex <em>hkl</em> Scan</p>
<div class="highlight-text notranslate" id="table-complexscan"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    entry:NXentry
<span class="linenos"> 2</span>        @default = data
<span class="linenos"> 3</span>        instrument:NXinstrument
<span class="linenos"> 4</span>            detector:NXdetector
<span class="linenos"> 5</span>                data[NP]
<span class="linenos"> 6</span>                polar_angle[NP]
<span class="linenos"> 7</span>                name
<span class="linenos"> 8</span>        sample:NXsample
<span class="linenos"> 9</span>            name
<span class="linenos">10</span>            rotation_angle[NP]
<span class="linenos">11</span>            chi[NP]
<span class="linenos">12</span>            phi[NP]
<span class="linenos">13</span>            h[NP]
<span class="linenos">14</span>            k[NP]
<span class="linenos">15</span>            l[NP]
<span class="linenos">16</span>        control:NXmonitor
<span class="linenos">17</span>            data[NP]
<span class="linenos">18</span>        data:NXdata
<span class="linenos">19</span>            @signal = data
<span class="linenos">20</span>            @axes = &quot;h&quot;
<span class="linenos">21</span>            @h_indices = 0
<span class="linenos">22</span>            @k_indices = 0
<span class="linenos">23</span>            @l_indices = 0
<span class="linenos">24</span>            @chi_indices = 0
<span class="linenos">25</span>            @phi_indices = 0
<span class="linenos">26</span>            @polar_angle_indices = 0
<span class="linenos">27</span>            @rotation_angle_indices = 0
<span class="linenos">28</span>            data --&gt; /entry/instrument/detector/data
<span class="linenos">29</span>            rotation_angle --&gt; /entry/sample/rotation_angle
<span class="linenos">30</span>            chi --&gt; /entry/sample/chi
<span class="linenos">31</span>            phi --&gt; /entry/sample/phi
<span class="linenos">32</span>            polar_angle --&gt; /entry/instrument/detector/polar_angle
<span class="linenos">33</span>            h --&gt; /entry/sample/h
<span class="linenos">34</span>            k --&gt; /entry/sample/k
<span class="linenos">35</span>            l --&gt; /entry/sample/l
</pre></div>
</div>
</div>
</section>
<section id="multi-parameter-scan-xas">
<h4>Multi-parameter scan: XAS<a class="headerlink" href="#multi-parameter-scan-xas" title="Link to this heading">¶</a></h4>
<p>Data can be stored almost anywhere in the NeXus tree.  While the previous examples
showed data arrays in either <code class="docutils literal notranslate"><span class="pre">NXdetector</span></code> or <code class="docutils literal notranslate"><span class="pre">NXsample</span></code>,
this example demonstrates that data can be stored in other places.  Links are used
to reference the data.</p>
<p>The example is for X-ray Absorption Spectroscopy (XAS) data where the monochromator
energy is step-scanned and counts are read back from detectors before (<code class="docutils literal notranslate"><span class="pre">I0</span></code>)
and after (<code class="docutils literal notranslate"><span class="pre">I</span></code>) the sample.  These energy scans are repeated at a sequence
of sample temperatures to map out, for example, a phase transition.  While it is customary
in XAS to plot <em>log(I0/I)</em>, we show them separately here
in two different <code class="docutils literal notranslate"><span class="pre">NXdata</span></code>
groups to demonstrate that such things are possible.
Note that the length of the 1-D energy array is <code class="docutils literal notranslate"><span class="pre">NE</span></code> while
the length of the 1-D temperature array is <code class="docutils literal notranslate"><span class="pre">NT</span></code></p>
<blockquote>
<div><div class="compound">
<p class="rubric">NeXus Multi-parameter scan: XAS</p>
<div class="highlight-text notranslate" id="table-xasscan"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    entry:NXentry
<span class="linenos"> 2</span>        @default = &quot;I_data&quot;
<span class="linenos"> 3</span>        instrument:NXinstrument
<span class="linenos"> 4</span>            I:NXdetector
<span class="linenos"> 5</span>                data:NX_NUMBER[NE,NT]
<span class="linenos"> 6</span>                energy --&gt; /entry/monochromator/energy
<span class="linenos"> 7</span>                temperature --&gt; /entry/sample/temperature
<span class="linenos"> 8</span>            I0:NXdetector
<span class="linenos"> 9</span>                data:NX_NUMBER[NE,NT]
<span class="linenos">10</span>                energy --&gt; /entry/monochromator/energy
<span class="linenos">11</span>                temperature --&gt; /entry/sample/temperature
<span class="linenos">12</span>        sample:NXsample
<span class="linenos">13</span>            temperature:NX_NUMBER[NT]
<span class="linenos">14</span>        monochromator:NXmonochromator
<span class="linenos">15</span>            energy:NX_NUMBER[NE]
<span class="linenos">16</span>        I_data:NXdata
<span class="linenos">17</span>            @signal = &quot;data&quot;
<span class="linenos">18</span>            @axes = [&quot;energy&quot;, &quot;temperature&quot;]
<span class="linenos">19</span>            @energy_indices = 0
<span class="linenos">20</span>            @temperature_indices = 0
<span class="linenos">21</span>            data --&gt; /entry/instrument/I/data
<span class="linenos">22</span>            energy --&gt; /entry/monochromator/energy
<span class="linenos">23</span>            temperature --&gt; /entry/sample/temperature
<span class="linenos">24</span>        I0_data:NXdata
<span class="linenos">25</span>            @signal = data
<span class="linenos">26</span>            @axes = [&quot;energy&quot;, &quot;temperature&quot;]
<span class="linenos">27</span>            @energy_indices = 0
<span class="linenos">28</span>            @temperature_indices = 0
<span class="linenos">29</span>            data --&gt; /entry/instrument/I00/data
<span class="linenos">30</span>            energy --&gt; /entry/monochromator/energy
<span class="linenos">31</span>            temperature --&gt; /entry/sample/temperature
</pre></div>
</div>
</div>
</div></blockquote>
</section>
</section>
<section id="rastering">
<span id="rules-specialcases-rastering"></span><h3>Rastering<a class="headerlink" href="#rastering" title="Link to this heading">¶</a></h3>
<p>Rastering is the process of making experiments at various locations in the
sample volume. Again, rasterisation experiments can be variable. Some people
even raster on spirals! Rasterisation experiments are treated the same way as
described above for scans. Just replace <code class="docutils literal notranslate"><span class="pre">NP</span></code> with
<code class="docutils literal notranslate"><span class="pre">P</span></code>, the number of raster points.</p>
<p>Special rules apply if a rasterisation happens on a regular grid of size
<code class="docutils literal notranslate"><span class="pre">xraster,</span> <span class="pre">yraster</span></code>. Then the variables varied in the rasterisation will be
of dimensions <code class="docutils literal notranslate"><span class="pre">xraster,</span> <span class="pre">yraster</span></code> and the detector data of dimensions
<code class="docutils literal notranslate"><span class="pre">xraster,</span> <span class="pre">yraster,</span> <span class="pre">(orginal</span> <span class="pre">dimensions)</span></code>
of the detector. For example, an area detector of
size <code class="docutils literal notranslate"><span class="pre">xsize,</span> <span class="pre">ysize</span></code> then it is stored with
dimensions <code class="docutils literal notranslate"><span class="pre">xraster,</span> <span class="pre">yraster,</span> <span class="pre">xsize,</span> <span class="pre">ysize</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be warned: if you use the 2D rasterisation method with <code class="docutils literal notranslate"><span class="pre">xraster,</span> <span class="pre">yraster</span></code> you may end up with
invalid data if the scan is aborted prematurely. This cannot happen if the first method is used.</p>
</div>
</section>
<section id="streaming-data-acquisition-and-logging">
<h3>Streaming Data Acquisition And Logging<a class="headerlink" href="#streaming-data-acquisition-and-logging" title="Link to this heading">¶</a></h3>
<p>More and more data is collected in streaming mode. This means that time stamped data is logged for one or more inputs,
possibly together with detector data. Another use case is the logging of parameters, for example temperature, while a long
running data collection is in progress. NeXus covers this case too. There is one simple rule for structuring such files:</p>
<p>Just use the standard NeXus raw data file structure, but replace the corresponding data object
with an <a class="reference internal" href="classes/base_classes/NXlog.html#nxlog"><span class="std std-ref">NXlog</span></a> or <a class="reference internal" href="classes/base_classes/NXevent_data.html#nxevent-data"><span class="std std-ref">NXevent_data</span></a> structure of the same name.</p>
<p>For example, consider your instrument is streaming detector images against a magnetic_field on the sample. In this case both
NXsample/magnetic_field and NXdetector/data would become NXlog structures instead of simple arrays i.e. the NXlog structure will
have the same name as the NeXus field involved.</p>
</section>
<section id="nxcollection">
<h3>NXcollection<a class="headerlink" href="#nxcollection" title="Link to this heading">¶</a></h3>
<p>On demand from the community, NeXus introduced a more informal method of
storing information in a NeXus file.  This is the <code class="docutils literal notranslate"><span class="pre">NXcollection</span></code>
class which can appear anywhere underneath <code class="docutils literal notranslate"><span class="pre">NXentry</span></code>.
<code class="docutils literal notranslate"><span class="pre">NXcollection</span></code> is a container for holding other data.
The foreseen use is to document collections of similar data which do not
otherwise fit easily into the <code class="docutils literal notranslate"><span class="pre">NXinstrument</span></code>
or <code class="docutils literal notranslate"><span class="pre">NXsample</span></code> hierarchy, such as the intent to record
<em>all</em> motor positions on a synchrotron beamline.
Thus, <code class="docutils literal notranslate"><span class="pre">NXcollection</span></code> serves as a quick point of access
to data for an instrument scientist or another expert. NXcollection is
also a feature for those who are too lazy to build up the complete NeXus
hierarchy.  An example usage case is documented in figure
<a class="reference internal" href="#table-nxcollection"><span class="std std-ref">NXcollection example</span></a>.</p>
<blockquote>
<div><div class="compound">
<p class="rubric"><code class="docutils literal notranslate"><span class="pre">NXcollection</span></code> Example</p>
<div class="highlight-text notranslate" id="table-nxcollection"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    entry:NXentry
<span class="linenos"> 2</span>        positioners:NXcollection
<span class="linenos"> 3</span>            mxx:NXpositioner
<span class="linenos"> 4</span>            mzz:NXpositioner
<span class="linenos"> 5</span>            sgu:NXpositioner
<span class="linenos"> 6</span>            ttv:NXpositioner
<span class="linenos"> 7</span>            hugo:NXpositioner
<span class="linenos"> 8</span>            ....
<span class="linenos"> 9</span>        scalars:NXcollection
<span class="linenos">10</span>            title (dataset)
<span class="linenos">11</span>            lieselotte (dataset)
<span class="linenos">12</span>            ...
<span class="linenos">13</span>        detectors:NXcollection
<span class="linenos">14</span>            Pilatus:NXdata
<span class="linenos">15</span>            MXX-45:NXdata
<span class="linenos">16</span>            ....           
</pre></div>
</div>
</div>
</div></blockquote>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">1.2.3.1. Rules for Structuring Information in NeXus Files</a><ul>
<li><a class="reference internal" href="#content-of-a-raw-data-nxentry-group">Content of a Raw Data <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> Group</a></li>
<li><a class="reference internal" href="#content-of-a-processed-data-nxentry-group">Content of a processed data <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group</a></li>
<li><a class="reference internal" href="#nxsubentry-or-multi-method-data"><code class="docutils literal notranslate"><span class="pre">NXsubentry</span></code> or Multi-Method Data</a></li>
<li><a class="reference internal" href="#rules-for-special-cases">Rules for Special Cases</a><ul>
<li><a class="reference internal" href="#scans">Scans</a><ul>
<li><a class="reference internal" href="#simple-scan">Simple scan</a></li>
<li><a class="reference internal" href="#simple-scan-with-area-detector">Simple scan with area detector</a></li>
<li><a class="reference internal" href="#complex-hkl-scan">Complex <em>hkl</em> scan</a></li>
<li><a class="reference internal" href="#multi-parameter-scan-xas">Multi-parameter scan: XAS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rastering">Rastering</a></li>
<li><a class="reference internal" href="#streaming-data-acquisition-and-logging">Streaming Data Acquisition And Logging</a></li>
<li><a class="reference internal" href="#nxcollection">NXcollection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="design.html"
                          title="previous chapter"><span class="section-number">1.2. </span>NeXus Design</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="datarules.html"
                          title="next chapter"><span class="section-number">1.2.3.2. </span>Rules for Storing Data Items in NeXus Files</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <p>Have a Question? <a href="https://github.com/nexusformat/definitions/issues/new">Get help</a></p>
    <ul class="this-page-menu">
    <style>
		  .avatar-container {
		    display: flex;
		    align-items: center;
		  }
		
		  .avatar {
		    width: 32px;
		    height: 32px;
		    border-radius: 50%;
		    margin-right: 5px;
		  }
		</style>
		
    
    
		<div class="avatar-container">
      
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
<div id="google_search" style="display: none">
	<hr />
	<h3>Google search</h3>
	<form method="get" action="https://www.google.com/search">
		<table border="0" align="center" cellpadding="0">
			<tr>
				<td>
					<input type="text"   name="q" value="" />
				</td>
			</tr>
			<tr>
				<td align="center" style="font-size:75%">
					<input type="radio"  name="sitesearch" value="" />global
					<input type="radio"  name="sitesearch"
						value="manual.nexusformat.org" 
						checked />NeXus manual
					<input type="submit" value="Go" />
					<br />
				</td>
			</tr>
		</table>
	</form>                                
</div>
<script type="text/javascript">$('#google_search').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="datarules.html" title="1.2.3.2. Rules for Storing Data Items in NeXus Files"
             >next</a> |</li>
        <li class="right" >
          <a href="design.html" title="1.2. NeXus Design"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">nexus v2024.02 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="user_manual.html" ><span class="section-number">1. </span>NeXus: User Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="design.html" ><span class="section-number">1.2. </span>NeXus Design</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">1.2.3.1. </span>Rules for Structuring Information in NeXus Files</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="copyright.html">Copyright</a> 1996-2024, NIAC, https://www.nexusformat.org.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>